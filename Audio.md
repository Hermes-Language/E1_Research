# E1音频输入/输出研究报告  

---

## 硬件与内核信息
| 项目     | 内容                                                         |
| -------- | ------------------------------------------------------------ |
| SoC      | Rockchip RK3308                                              |
| 音频 IP  | 内置 Audio Codec + PDM 麦克风阵列控制器                      |
| 物理接口 | 1) 4-pole 3.5 mm 耳机孔（TRRS）<br>2) 板载 PDM 数字麦克风阵列 |
| 内核版本 | Linux 5.x（ALSA 1.2.x）                                      |

---

## ALSA 设备拓扑

| Card  | 逻辑名                 | 功能          | 物理映射                   |
| ----- | ---------------------- | ------------- | -------------------------- |
| card0 | rockchip,rk3308-acodec | 模拟输入/输出 | 耳机孔 + 板载模拟 MIC 群组 |
| card1 | rockchip,rk3308-pcm    | I²S/PCM 外接  | 空载（未接外部 codec）     |
| card2 | rockchip,pdm-mic-array | 数字麦克风    | PDM 麦克风阵列             |
| card7 | Loopback               | 虚拟回环      | 软件内部路由               |

---

## 输出（Playback）能力: 耳机孔 / 扬声器
- **设备节点**：`hw:0,0`  
- **支持格式**：S16_LE / S24_LE / S32_LE  
- **采样率**：8 kHz – 192 kHz  
- **最大声道**：8（实际耳机孔仅 2 ch，板载扬声器为 2 ch）  
- **插拔检测**：有（自动切换耳机 ↔ 扬声器）

---

## 输入（Capture）能力

### 板载模拟麦克风群组（MIC Group 0-3）
- **设备节点**：`hw:0,0`  
- **最高规格**：192 kHz / 32-bit / 8 ch  
- **物理接口**：板载 MEMS 模拟麦克风阵列  
- **耳机孔麦克风**：**不支持** ==**TODO: 待验证应为我没有带有麦克风的耳机**==

### 5.2 PDM 数字麦克风阵列
- **设备节点**：`hw:2,0`  
- **最高规格**：192 kHz / 32-bit / 8 ch  
- **物理接口**：板载 PDM 麦克风阵列  
- **推荐用途**：远场语音识别、波束成形

---

## 耳机孔麦克风支持判定

| 检测方法                                  | 结果                     | 备注                               |
| ----------------------------------------- | ------------------------ | ---------------------------------- |
| `/proc/asound/card0/pcm0c/sub0/hw_params` | `closed`                 | 无录音流                           |
| `amixer contents \| grep -i mic`          | 仅有 `ADC MIC Group X`   | 无 `Headset Mic` / `Jack Mic` 控件 |
| 插入 TRRS 耳机 + `arecord`                | 录音失败/静音            | 验证硬件未连接                     |
| **结论**                                  | ❌ **不支持耳机孔麦克风** | 需硬件改版才能支持                 |

---

## 限制与注意事项
1. **耳机孔无麦克风输入**，若需耳机麦，需硬件改动。  
2. 使用 `hw:0,0` 录音时，最小通道数为 **2**；强制单声道请用 `plughw:0,0`。  
3. 192 kHz/32-bit 仅在 **PDM 阵列** 与 **模拟 codec** 理论上可达，实际模拟前端（MICBIAS、ADC PGA）可能限制为 48 kHz/16-bit，需实测验证。